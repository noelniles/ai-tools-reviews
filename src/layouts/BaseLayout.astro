---
import { ANALYTICS_CONFIG } from '../lib/analytics';

const { title = 'AI Tools Reviews', description = 'Independent reviews and benchmarks of AI tools.' } = Astro.props
const currentPath = Astro.url.pathname;
---

<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    
    <!-- Google Analytics 4 -->
    {ANALYTICS_CONFIG.googleAnalyticsId && ANALYTICS_CONFIG.googleAnalyticsId !== 'G-XXXXXXXXXX' && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${ANALYTICS_CONFIG.googleAnalyticsId}`}></script>
        <script is:inline define:vars={{ gaId: ANALYTICS_CONFIG.googleAnalyticsId }}>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', gaId, {
            send_page_view: true,
            anonymize_ip: true,
          });
        </script>
      </>
    )}
    
    <!-- Plausible Analytics (Privacy-focused alternative) -->
    {ANALYTICS_CONFIG.plausibleDomain && (
      <script defer data-domain={ANALYTICS_CONFIG.plausibleDomain} src="https://plausible.io/js/script.js"></script>
    )}
    
    <!-- Fathom Analytics (Privacy-focused alternative) -->
    {ANALYTICS_CONFIG.fathomSiteId && (
      <script src="https://cdn.usefathom.com/script.js" data-site={ANALYTICS_CONFIG.fathomSiteId} defer></script>
    )}
  </head>
  <body class="min-h-full bg-slate-950 text-slate-100">
    <main class="max-w-5xl mx-auto px-4 py-6">
      <slot />
    </main>
    
    <!-- Footer -->
    <footer class="max-w-5xl mx-auto px-4 py-12 mt-16 border-t border-slate-800">
      <div class="grid md:grid-cols-3 gap-8 mb-8">
        <div>
          <h3 class="font-bold mb-3 text-slate-100">AI Tools Reviews</h3>
          <p class="text-sm text-slate-400">Independent, honest reviews of AI tools to help you make informed decisions.</p>
        </div>
        <div>
          <h4 class="font-semibold mb-3 text-slate-100">Quick Links</h4>
          <ul class="space-y-2 text-sm text-slate-400">
            <li><a href="/" class="hover:text-brand transition-colors">Home</a></li>
            <li><a href="/reviews" class="hover:text-brand transition-colors">All Reviews</a></li>
            <li><a href="/compare" class="hover:text-brand transition-colors">Compare Tools</a></li>
            <li><a href="/submit-review" class="hover:text-brand transition-colors">Submit Review</a></li>
            <li><a href="/methodology" class="hover:text-brand transition-colors">Methodology</a></li>
            <li><a href="/about" class="hover:text-brand transition-colors">About</a></li>
            <li><a href="/contact" class="hover:text-brand transition-colors">Contact</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3 text-slate-100">Newsletter</h4>
          <p class="text-sm text-slate-400 mb-3">Get weekly AI tool reviews and comparisons.</p>
          <form 
            action={import.meta.env.PUBLIC_FORMSPREE_NEWSLETTER_ID ? `https://formspree.io/f/${import.meta.env.PUBLIC_FORMSPREE_NEWSLETTER_ID}` : 'https://formspree.io/f/YOUR_FORM_ID'}
            method="POST"
            class="flex gap-2"
            id="newsletter-form"
          >
            <input 
              type="email" 
              name="email"
              placeholder="your@email.com" 
              required
              class="flex-1 px-3 py-2 bg-slate-900 border border-slate-800 rounded text-sm focus:outline-none focus:border-brand"
            />
            <button 
              type="submit"
              class="px-4 py-2 bg-brand hover:bg-brand/80 rounded text-sm font-semibold transition-colors"
            >
              Subscribe
            </button>
          </form>
        </div>
      </div>
      <div class="pt-8 border-t border-slate-800 text-sm text-slate-500 text-center">
        <p>Â© {new Date().getFullYear()} AI Tools Reviews. We may earn commissions from affiliate links.</p>
      </div>
    </footer>
    
    <!-- Engagement Tracking -->
    <script>
      // Track time on page
      let startTime = Date.now();
      let maxScrollDepth = 0;
      
      // Scroll depth tracking
      function updateScrollDepth() {
        const scrollPercentage = Math.round(
          (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100
        );
        if (scrollPercentage > maxScrollDepth) {
          maxScrollDepth = scrollPercentage;
        }
      }
      
      window.addEventListener('scroll', () => {
        updateScrollDepth();
      });
      
      // Track when user leaves
      window.addEventListener('beforeunload', () => {
        const timeOnPage = Math.round((Date.now() - startTime) / 1000);
        
        // Send analytics
        if (typeof gtag !== 'undefined') {
          gtag('event', 'engagement', {
            time_on_page: timeOnPage,
            scroll_depth: maxScrollDepth,
            page_path: window.location.pathname,
          });
        }
      });
      
      // Track affiliate link clicks
      document.addEventListener('click', (e) => {
        const target = e.target.closest('a');
        if (!target) return;
        
        const href = target.getAttribute('href');
        if (!href) return;
        
        // Check if it's an affiliate link
        if (target.dataset.affiliate === 'true' || target.classList.contains('affiliate-link')) {
          const toolName = target.dataset.tool || 'unknown';
          
          if (typeof gtag !== 'undefined') {
            gtag('event', 'affiliate_click', {
              tool_name: toolName,
              link_url: href,
              link_text: target.textContent?.trim() || '',
            });
          }
        }
        
        // Track outbound links
        if (href.startsWith('http') && !href.includes(window.location.hostname)) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'outbound_link', {
              url: href,
              text: target.textContent?.trim() || '',
            });
          }
        }
      });
      
      // Track newsletter signups
      const newsletterForm = document.getElementById('newsletter-form');
      if (newsletterForm) {
        newsletterForm.addEventListener('submit', () => {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'newsletter_signup', {
              location: 'footer',
              value: 5,
            });
          }
        });
      }
    </script>
  </body>
</html>
